# Day 01 - Piscine SQL

## _First steps working with sets and JOINs in SQL_

Resume: Today you will see how to get needed data based on sets constructions and simple JOINs

## Contents

1. [Глава I](#chapter-i) \
    1.1. [Преамбула](#preamble)
2. [Глава II](#chapter-ii) \
    2.1. [Основные правила](#general-rules)
3. [Глава III](#chapter-iii) \
    3.1. [Правила дня](#rules-of-the-day)  
4. [Глава IV](#chapter-iv) \
    4.1. [Упражнение 00 - Заставим UNION танцевать](#exercise-00-lets-make-union-dance)  
5. [Глава V](#chapter-v) \
    5.1. [Упражнение 01 - танец UNION с подзапросом](#exercise-01-union-dance-with-subquery)  
6. [Глава VI](#chapter-vi) \
    6.1. [Упражнение 02 - Дублирует или не дублирует](#exercise-02-duplicates-or-not-duplicates)  
7. [Глава VII](#chapter-vii) \
    7.1. [Упражнение 03 - "Тайные" знания](#exercise-03-hidden-insights)  
8. [Глава VIII](#chapter-viii) \
    8.1. [Упражнение 04 - Разница? Да, давайте найдем разницу между мультимножествами](#exercise-04-difference-yep-lets-find-the-difference-between-multisets)
9. [Глава IX](#chapter-ix) \
    9.1. [Упражнение 05 - Вы слышали о декартовом произведении?](#exercise-05-did-you-hear-about-cartesian-product)
10. [Глава X](#chapter-x) \
    10.1. [Упражнение 06 - Давайте посмотрим на "тайные" знания](#exercise-06-lets-see-on-hidden-insights)
11. [Глава XI](#chapter-xi) \
    11.1. [Упражнение 07 - Просто сделайте JOIN](#exercise-07-just-make-a-join)
12. [Глава XII](#chapter-xii) \
    12.1. [Упражнение 08 - Перенос JOIN в NATURAL JOIN](#exercise-08-migrate-join-to-natural-join)
13. [Глава XIII](#chapter-xiii) \
    13.1. [Упражнение 09 - IN против EXISTS](#exercise-09-in-versus-exists)
14. [Глава XIV](#chapter-xiv) \
    14.1. [Упражнение 10 - Глобальный JOIN](#exercise-10-global-join)


## Глава I
## Преамбула

![D01_01](misc/images/D01_01.png)

Во многих аспектах наборы используются в реляционных базах данных. Не просто для ОБЪЕДИНЕНИЯ или поиска исключений между наборами. Наборы также являются хорошим инструментом для выполнения рекурсивных запросов.

В PostgreSQL есть следующие операторы множеств:
- UNION [ALL]
- EXCEPT [ALL] 
- INTERSECT [ALL]

Ключевое слово “ALL” означает сохранение дубликатов строк в результате. Основные правила работы с наборами приведены ниже.

- Основной SQL предоставляет окончательные имена атрибутов для всего запроса.
- Атрибуты контролируемого SQL должны соответствовать количеству столбцов и соответствующим типам семейства основного SQL.

![D01_02](misc/images/D01_02.png)

Кроме того, наборы SQL полезны для расчета некоторых конкретных показателей науки о данных, например, расстояния Жаккара между двумя объектами на основе существующих функций данных.

## Глава II
## Основные правила

- Используйте эту страницу как единственную инструкцию. Не слушайте никаких слухов и домыслов о том, как подготовить своё решение.
- Пожалуйста, убедитесь, что вы используете последнюю версию PostgreSQL.
- Это совершенно нормально, если вы используете IDE для написания исходного кода (он же SQL-скрипт).
- Для оценки ваше решение должно находиться в вашем репозитории GIT.
- Ваши решения будут оценены вашими товарищами по интенсиву.
- Вы не должны оставлять в своем каталоге никаких других файлов, кроме тех, которые явно указаны в инструкциях к упражнению. Рекомендуется изменить ваш .gitignoreчтобы избежать случайностей.
- У вас есть вопрос? Спросите у соседа справа. Если не помогло - попробуйте с соседом слева.
- Ваш справочник: товарищи/интернет/гугл.
- Внимательно прочитайте примеры. Они могут понять вещи, которые иначе не указаны в задании. 
- И да прибудет с вами сила SQL!
- Абсолютно все можно представить в SQL! Давайте начнем и получайте удовольствие!

## Глава III
## Правила дня

- Убедитесь, что у вас есть собственная база данных и доступ к ней в вашем кластере PostgreSQL.
- Загрузите скрипт (materials/model.sql) с моделью базы данных здесь и примените его к своей базе данных (вы можете использовать командную строку с psql или просто запустить его через любую IDE, например DataGrip от JetBrains или pgAdmin от сообщества PostgreSQL).
- Все задачи содержат список разрешенных и запрещенных разделов с перечисленными параметрами базы данных, типами баз данных, конструкциями SQL и т. д. Пожалуйста, ознакомьтесь с разделом перед началом.
- Пожалуйста, взгляните на логическое представление нашей модели базы данных.

![schema](misc/images/schema.png)

1. Таблица **pizzeria** (Таблица-словарь с доступными пиццериями)
- поле ``id`` - первичный ключ (primary key)
- поле ``name`` - название пиццерии
- поле ``rating`` - средний рейтинг пиццерии (от 0 до 5 баллов)
2. Таблица **person** (Таблица-словарь с людьми, которые любят пиццу)
- поле ``id`` - первичный ключ (primary key)
- поле ``name`` - имя человека
- поле ``age`` - возраст человека
- поле ``gender`` - пол человека
- поле ``address`` - адрес человека
3. Таблица **menu** (Таблица-словарь с доступным меню и ценой на конкретную пиццу)
- поле ``id`` - первичный ключ (primary key)
- поле ``pizzeria_id`` - внешний ключ к пиццерии
- поле ``pizza_name`` - название пиццы в пиццерии
- поле ``price`` - цена конкретной пиццы
4. Таблица **person_visits** (Операционная таблица с информацией о посещениях пиццерии)
- поле ``id`` - первичный ключ (primary key)
- поле ``person_id`` - внешний ключ к человеку
- поле ``pizzeria_id`` - внешний ключ к пиццерии
- поле ``visit_date`` - дата (например 2022-01-01) посещения пиццерии человеком
5. Таблица **person_order** (операционная таблица с информацией о заказах людей)
- поле ``id`` - первичный ключ (primary key)
- поле ``person_id`` - внешний ключ к человеку
- поле ``menu_id`` - внешний ключ к меню
- поле ``order_date`` - дата (например 2022-01-01) заказа человека

Посещение (visit_date) и заказ (order_date) - это разные сущности, и нет никакой корреляции между их данными. Например, клиент может находиться в одном месте (просто просматривая меню) и в это время сделать заказ в другом по телефону или с помощью мобильного приложения. Или позвонить из дома с заказом без каких-либо визитов.

## Глава IV
## Упражнение 00 - Заставим UNION танцевать 

| Упражнение 00: Заставим UNION танцевать |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Каталог сдачи                     | ex00                                                                                                                     |
| Файлы для сдачи                      | `day01_ex00.sql`                                                                                 |
| **Разрешено**                               |                                                                                                                          |
| Язык                        | ANSI SQL                                                                                              |

Пожалуйста, напишите оператор SQL, который возвращает идентификатор меню и названия пицц из таблицы ``menu`` и идентификатор человека и имя человека из таблицы ``person`` в один глобальный список (имена столбцов представлены на образце ниже), упорядоченный по столбцу имя_объекта. 

| object_id | object_name |
| ------ | ------ |
| 1 | Анна |
| 1 | пицца с сыром |
| ... | ... |



## Глава V
## Упражнение 01 - танец UNION с подзапросом

| Упражнение 01: танец UNION с подзапросом |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Каталог сдачи                     | ex01                                                                                                                     |
| Файлы для сдачи                      | `day01_ex01.sql`                                                                                 |
| **Разрешено**                               |                                                                                                                          |
| Язык                        | ANSI SQL                                                                                              |

Измените оператор SQL из “Упражнение 00”, удалив столбец ``object_id``, а затем измените порядок по ``object_name`` для части данных из таблицы ``person``, а затем по таблицы ``menu`` (аналогично представленной на образце ниже). Пожалуйста, сохраняйте дубликаты! 

| object_name |
| ------ |
| Андрей |
| Анна |
| ... |
| пицца с сыром |
| пицца с сыром |
| ... |


## Глава VI
## Упражнение 02 - Дублирует или не дублирует

| Упражнение 02: Дублирует или не дублирует |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Каталог сдачи                     | ex02                                                                                                                     |
| Файлы для сдачи                      | `day01_ex02.sql`                                                                                 |
| **Разрешено**                               |                                                                                                                          |
| Язык                        | ANSI SQL                                                                                              |
| **Запрещено**                               |                                                                                                                          |
| Синтаксические конструкции SQL                        | `DISTINCT`, `GROUP BY`, `HAVING`, any type of `JOINs`                                                                                              |

Пожалуйста, напишите SQL, который возвращает уникальные названия пиццы из таблицы ``menu`` и упорядочивание по столбцу ``pizza_name`` в порядке убывания. Пожалуйста, обратите внимание на раздел "Запрещено".

## Глава VII
## Упражнение 03 - "Тайные" знания

| Упражнение 03: “Тайные” знания |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Каталог сдачи                     | ex03                                                                                                                     |
| Файлы для сдачи                      | `day01_ex03.sql`                                                                                 |
| **Разрешено**                               |                                                                                                                          |
| Язык                        | ANSI SQL                                                                                              |
| **Запрещено**                               |                                                                                                                          |
| Синтаксические конструкции SQL                        |  any type of `JOINs`                                                                                              |

Пожалуйста, напишите оператор SQL, который возвращает общие строки для атрибутов ``order_date``, ``person_id`` из таблицы ``person_order`` с одной стороны и ``visit_date``, ``person_id`` из таблицы ``person_visits`` с другой стороны (см. образец ниже). Другими словами, найдем идентификаторы людей, которые посетили, а затем заказали пиццу в один и тот же день. Добавьте сортировку по ``action_date`` по возрастанию, а затем по ``person_id`` по убыванию.

| action_date | person_id |
| ------ | ------ |
| 2022-01-01 | 6 |
| 2022-01-01 | 2 |
| 2022-01-01 | 1 |
| 2022-01-03 | 7 |
| 2022-01-04 | 3 |
| ... | ... |

## Глава VIII
## Упражнение 04 - Разница? Да, давайте найдем разницу между мультимножествами


| Упражнение 04: Разница? Да, давайте найдем разницу между мультимножествами |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Каталог сдачи                     | ex04                                                                                                                     |
| Файлы для сдачи                      | `day01_ex04.sql`                                                                                 |
| **Разрешено**                               |                                                                                                                          |
| Язык                        | ANSI SQL                                                                                              |
| **Запрещено**                               |                                                                                                                          |
| Синтаксические конструкции SQL                        |  any type of `JOINs`                                                                                              |

Пожалуйста, напишите оператор SQL, который возвращает разницу (минус) значений колонки ``person_id`` с сохранением дубликатов между таблицами `person_order` и `person_visits` table для order_date и visit_date на 7 января 2022 г.

## Глава IX
## Упражнение 05 - Вы слышали о декартовом произведении?


| Упражнение 05: Вы слышали о декартовом произведении? |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Каталог сдачи                     | ex05                                                                                                                     |
| Файлы для сдачи                      | `day01_ex05.sql`                                                                                 |
| **Разрешено**                               |                                                                                                                          |
| Язык                        | ANSI SQL                                                                                              |

Пожалуйста, напишите оператор SQL, который возвращает все возможные комбинации между таблицами ``person`` и ``pizzeria``, установите порядок сортировки по идентификатору человека, а затем по столбцам идентификатора пиццерии. Пожалуйста, взгляните на образец результата ниже. 

| person.id | person.name | age | gender | address | pizzeria.id | pizzeria.name | rating |
| ------ | ------ | ------ | ------ | ------ | ------ | ------ | ------ |
| 1 | Anna | 16 | female | Moscow | 1 | Pizza Hut | 4.6 |
| 1 | Anna | 16 | female | Moscow | 2 | Dominos | 4.3 |
| ... | ... | ... | ... | ... | ... | ... | ... |


## Глава X
## Упражнение 06 - Давайте взглянем на "тайные" знания

| Упражнение 06: Давайте посмотрим на "тайные" знания |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Каталог сдачи                     | ex06                                                                                                                     |
| Файлы для сдачи                      | `day01_ex06.sql`                                                                                 |
| **Разрешено**                               |                                                                                                                          |
| Язык                        | ANSI SQL                                                                                              |

Давайте вернемся к упражнению № 03 и изменим нашу инструкцию SQL, чтобы она возвращала имена людей вместо идентификаторов людей, и изменим порядок сортировки - сначала по ``action_date`` по возрастанию, а затем по ``person_name`` по убыванию. Пожалуйста, взгляните на образец данных ниже.

| action_date | person_name |
| ------ | ------ |
| 2022-01-01 | Irina |
| 2022-01-01 | Anna |
| 2022-01-01 | Andrey |
| ... | ... |

## Глава XI
## Упражнение 07 - Просто сделайте JOIN

| Упражнение 07: Просто сделайте JOIN |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Каталог сдачи                     | ex07                                                                                                                     |
| Файлы для сдачи                      | `day01_ex07.sql`                                                                                 |
| **Разрешено**                               |                                                                                                                          |
| Язык                        | ANSI SQL                                                                                              |

Напишите оператор SQL, который возвращает дату заказа из таблицы ``person_order`` и соответствующее имя человека (переименуйте выходной вычисляемый столбец в ``person_information``), который сделал заказ, из таблицы ``person``, как в следующем примере ниже. Добавьте сортировку по обоим столбцам по возрастанию. 

| order_date | person_information |
| ------ | ------ |
| 2022-01-01 | Andrey (age:21) |
| 2022-01-01 | Andrey (age:21) |
| 2022-01-01 | Anna (age:16) |
| ... | ... |


## Глава XII
## Упражнение 08 - Перенос JOIN в NATURAL JOIN


| Упражнение 08: Перенос JOIN в NATURAL JOIN |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Каталог сдачи                     | ex08                                                                                                                     |
| Файлы для сдачи                      | `day01_ex08.sql`                                                                                 |
| **Разрешено**                               |                                                                                                                          |
| Язык                        | ANSI SQL                                                                                              |
| Синтаксические конструкции SQL                        | `NATURAL JOIN`                                                                                              |
| **Запрещено**                               |                                                                                                                          |
| Синтаксические конструкции SQL                        | other type of  `JOINs`                                                                                              |

Пожалуйста, перепишите оператор SQL из упражнения № 07, используя конструкцию NATURAL JOIN. Результат должен быть такой же как в упражнении #07.  

## Глава XIII
## Упражнение 09 - IN против EXISTS


| Упражнение 09: IN против EXISTS |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Каталог сдачи                     | ex09                                                                                                                     |
| Файлы для сдачи                      | `day01_ex09.sql`                                                                                 |
| **Разрешено**                               |                                                                                                                          |
| Язык                        | ANSI SQL                                                                                              |

Пожалуйста, напишите 2 оператора SQL, которые возвращают список названий пиццерий, которые не посещались людьми, используя IN для 1-го и EXISTS для 2-го.

## Глава XIV
## Упражнение 10 - Глобальный JOIN


| Exercise 10: Глобальный JOIN |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Каталог сдачи                     | ex10                                                                                                                     |
| Файлы для сдачи                      | `day01_ex10.sql`                                                                                 |
| **Разрешено**                               |                                                                                                                          |
| Язык                        | ANSI SQL                                                                                              |

Пожалуйста, напишите оператор SQL, который возвращает список имен людей, сделавших заказ на пиццу в соответствующей пиццерии. Пример результата (с именованными столбцами) представлен ниже, и да... пожалуйста, упорядочьте по 3 столбцам в порядке возрастания. 

| person_name | pizza_name | pizzeria_name | 
| ------ | ------ | ------ |
| Andrey | cheese pizza | Dominos |
| Andrey | mushroom pizza | Dominos |
| Anna | cheese pizza | Pizza Hut |
| ... | ... | ... |

